<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regulator Dashboard - Report Approval</title>
    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 20px 0;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        header h1 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        header p {
            text-align: center;
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }
        
        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
        }
        
        .pending-reports, .ipfs-process {
            background: white;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .section-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #1e3c72;
            border-bottom: 2px solid #eaeaea;
            padding-bottom: 10px;
        }
        
        .report-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .report-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        
        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .report-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2a5298;
        }
        
        .report-date {
            color: #777;
            font-size: 0.9rem;
        }
        
        .report-details {
            margin-bottom: 15px;
        }
        
        .report-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-approve {
            background-color: #4CAF50;
            color: white;
        }
        
        .btn-approve:hover {
            background-color: #45a049;
        }
        
        .btn-reject {
            background-color: #f44336;
            color: white;
        }
        
        .btn-reject:hover {
            background-color: #da190b;
        }
        
        .btn-view {
            background-color: #2196F3;
            color: white;
        }
        
        .btn-view:hover {
            background-color: #0b7dda;
        }
        
        .ipfs-process {
            display: flex;
            flex-direction: column;
        }
        
        .process-container {
            border: 2px dashed #007bff;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .step {
            margin: 15px 0;
            padding: 10px;
            border-left: 4px solid #007bff;
            transition: all 0.3s;
        }
        
        .step.active {
            border-left-color: #4CAF50;
            background-color: #f0f8ff;
        }
        
        .step.completed {
            border-left-color: #4CAF50;
            background-color: #f0fff0;
        }
        
        .results {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            display: none;
            margin-top: 20px;
        }
        
        .hash {
            font-family: monospace;
            background: #000;
            color: #0f0;
            padding: 10px;
            word-break: break-all;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-approved {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-rejected {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #777;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #ccc;
        }
        
        .debug-info {
            background: #fff3cd;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .file-preview {
            background-color: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 15px;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 0.9rem;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background-color: #4CAF50;
            color: white;
            border-radius: 5px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: none;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="notification" id="notification">
        Report approved and stored successfully!
    </div>
    
    <div class="container">
        <header>
            <h1>Regulator Dashboard</h1>
            <p>Approve or reject NGO reports and store them on IPFS & Blockchain</p>
        </header>
        
        <div class="dashboard">
            <div class="pending-reports">
                <h2 class="section-title">Pending Reports for Approval</h2>
                <div id="reportsList">
                    <div class="empty-state">
                        <i>üìã</i>
                        <h3>No pending reports</h3>
                        <p>Reports submitted by NGOs will appear here for approval.</p>
                    </div>
                </div>
            </div>
            
            <div class="ipfs-process">
                <h2 class="section-title">IPFS & Blockchain Process</h2>
                
                <div class="process-container">
                    <div id="selectedReportInfo" style="display: none;">
                        <h3>Selected Report: <span id="reportName">NGO_Report_2023.pdf</span></h3>
                        <p>Size: <span id="reportSize">2.5 MB</span></p>
                        <p>Submitted by: <span id="reportNGO">Green Earth NGO</span></p>
                        <div id="reportPreview" class="file-preview"></div>
                    </div>
                    
                    <div id="noSelectionInfo">
                        <h3>üìÅ Select a report to begin</h3>
                        <p>Choose a report from the pending list to start the IPFS upload and blockchain storage process.</p>
                    </div>
                    
                    <div id="progress">
                        <div class="step" id="step1">1. Report selected</div>
                        <div class="step" id="step2">2. Connect wallet (auto)</div>
                        <div class="step" id="step3">3. Upload to IPFS</div>
                        <div class="step" id="step4">4. Store on blockchain</div>
                        <div class="step" id="step5">5. Complete!</div>
                    </div>
                    
                    <button onclick="startVerificationProcess()" id="verifyBtn" class="btn btn-approve" style="display: none; margin-top: 20px; align-self: center;">
                        ‚úÖ Verify & Store on IPFS/Blockchain
                    </button>
                </div>
                
                <div id="loading" class="loading">
                    <p>‚è≥ Processing... Please confirm MetaMask transactions</p>
                </div>
                
                <div id="results" class="results">
                    <h3>‚úÖ Success! Report stored on decentralized network</h3>
                    <div id="resultContent"></div>
                </div>
            </div>
        </div>
        
        <div class="debug-info">
            <h3>üîß Debug Information</h3>
            <div id="debugInfo">Status: Ready. No report selected.</div>
        </div>
    </div>

    <script>
        // Configuration
        const CONTRACT_ADDRESS = "0x7354CD3643264bAe341C73F24454bDA09c383F97";
        const CONTRACT_ABI = [ 
            {
                "inputs": [
                    {"internalType": "string", "name": "_ipfsHash", "type": "string"},
                    {"internalType": "string", "name": "_fileName", "type": "string"}, 
                    {"internalType": "uint256", "name": "_fileSize", "type": "uint256"}
                ],
                "name": "storeHash",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "nonpayable",
                "type": "function"
            },
            {
                "inputs": [],
                "name": "getFilesCount",
                "outputs": [{"internalType": "uint256", "name": "", "type": "uint256"}],
                "stateMutability": "view",
                "type": "function"
            }
        ];

        const PINATA_JWT = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySW5mb3JtYXRpb24iOnsiaWQiOiI2MjQxOWY0Ny1hYTJjLTRjNjgtOWMxMi05ODM5YTZmNWFlNWQiLCJlbWFpbCI6Imt1c2h3YWhhdmFydW45ODhAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOnRydWUsInBpbl9wb2xpY3kiOnsicmVnaW9ucyI6W3siZGVzaXJlZFJlcGxpY2F0aW9uQ291bnQiOjEsImlkIjoiRlJBMSJ9LHsiZGVzaXJlZFJlcGxpY2F0aW9uQ291bnQiOjEsImlkIjoiTllDMSJ9XSwidmVyc2lvbiI6MX0sIm1mYV9lbmFibGVkIjpmYWxzZSwic3RhdHVzIjoiQUNUSVZFIn0sImF1dGhlbnRpY2F0aW9uVHlwZSI6InNjb3BlZEtleSIsInNjb3BlZEtleUtleSI6IjViOGMyOWFhMjFjMGRkZjQ3NzFhIiwic2NvcGVkS2V5U2VjcmV0IjoiYWY2ZTVlOGRlZTdiZTliYmI1NzUwMjM2YWQwMGI3M2MyMGE0MTBiOGE3ZmIyODVmMDk4MWJmYjhmY2UwNDlhNSIsImV4cCI6MTc5MDIwMTk1MH0.evw44SeuKEXvFR5K5PTW55MMHUUT5At7rGDjEEuA8JM";

        // Global variables
        let web3;
        let accounts;
        let contract;
        let selectedReport = null;
        let pendingReports = [];

        // Initialize the page
   // Initialize the page
document.addEventListener('DOMContentLoaded', function() {
    // Initialize pendingReports array
    if (!pendingReports) {
        pendingReports = [];
    }
    
    // Check if there's a report passed from ngo.html
    checkForNewReport();
    renderPendingReports();
    updateStep(1);
});

        // Check if a report was passed from ngo.html
        function checkForNewReport() {
            // Check URL parameters first
            const urlParams = new URLSearchParams(window.location.search);
            const reportData = urlParams.get('report');
            
            if (reportData) {
                try {
                    const newReport = JSON.parse(decodeURIComponent(reportData));
                    addReport(newReport);
                    
                    // Clean the URL
                    window.history.replaceState({}, document.title, window.location.pathname);
                } catch (e) {
                    console.error('Error parsing report data:', e);
                }
            }
            
            // Also check localStorage for reports
            const storedReports = localStorage.getItem('pendingReports');
            if (storedReports) {
                try {
                    pendingReports = JSON.parse(storedReports);
                    renderPendingReports();
                } catch (e) {
                    console.error('Error loading stored reports:', e);
                }
            }
        }
// Show notification function
function showNotification(message) {
    // Create notification element if it doesn't exist
    let notification = document.getElementById('notification');
    if (!notification) {
        notification = document.createElement('div');
        notification.id = 'notification';
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            z-index: 1000;
            display: none;
        `;
        document.body.appendChild(notification);
    }
    
    notification.textContent = message;
    notification.style.display = 'block';
    
    // Auto hide after 3 seconds
    setTimeout(() => {
        notification.style.display = 'none';
    }, 3000);
}
        // Add a new report to the pending list
        function addReport(reportData) {
            // Generate a unique ID for the report
            const reportId = Date.now();
            
            const newReport = {
                id: reportId,
                title: reportData.plantationName + " Report",
                ngoName: reportData.ngoName,
                date: new Date().toISOString().split('T')[0],
                file: {
                    name: `BlueCarbon_Report_${reportData.plantationName.replace(/\s+/g, '_')}_${reportData.reportDate}.txt`,
                    size: 0, // Will be calculated
                    type: "text/plain"
                },
                reportData: reportData,
                content: generateReportContent(reportData)
            };
            
            // Calculate file size
            newReport.file.size = new Blob([newReport.content]).size;
            
            // Add to pending reports
            pendingReports.unshift(newReport);
            
            // Save to localStorage
            localStorage.setItem('pendingReports', JSON.stringify(pendingReports));
            
            // Update UI
            renderPendingReports();
            
            // Show notification
            showNotification('New report received from ' + reportData.ngoName);
        }

        // Generate report content from form data (same as in ngo.html)
        function generateReportContent(formData) {
            return `
BLUE CARBON PROJECT REPORT
==========================

NGO INFORMATION:
‚Ä¢ NGO Name: ${formData.ngoName}
‚Ä¢ Registration Number: ${formData.registrationNo}
‚Ä¢ Contact Person: ${formData.contactPerson}
‚Ä¢ Contact Email: ${formData.contactEmail}

PROJECT DETAILS:
‚Ä¢ Plantation Name: ${formData.plantationName}
‚Ä¢ Report Date: ${formData.reportDate}
‚Ä¢ Coastal Region: ${formData.coastalRegion}
‚Ä¢ Area Covered: ${formData.areaCovered} hectares

PLANTATION INFORMATION:
‚Ä¢ Tree Species: ${formData.treeSpecies}
‚Ä¢ Saplings Planted: ${formData.saplingsPlanted}
‚Ä¢ Survival Rate: ${formData.survivalRate}%
‚Ä¢ Carbon Absorbed: ${formData.carbonAbsorbed} tons CO‚ÇÇ/year

BIODIVERSITY IMPACT:
${formData.biodiversityImpact || 'Not provided'}

ADDITIONAL INFORMATION:
${formData.additionalInfo || 'Not provided'}

Report Generated on: ${new Date().toLocaleString()}
            `;
        }

        // Render the list of pending reports
        function renderPendingReports() {
            const reportsList = document.getElementById('reportsList');
            
            if (pendingReports.length === 0) {
                reportsList.innerHTML = `
                    <div class="empty-state">
                        <i>üìã</i>
                        <h3>No pending reports</h3>
                        <p>Reports submitted by NGOs will appear here for approval.</p>
                    </div>
                `;
                return;
            }
            
            reportsList.innerHTML = '';
            
            pendingReports.forEach(report => {
                const reportCard = document.createElement('div');
                reportCard.className = 'report-card';
                reportCard.innerHTML = `
                    <div class="report-header">
                        <div class="report-title">${report.title}</div>
                        <span class="status-badge status-pending">Pending</span>
                    </div>
                    <div class="report-details">
                        <p><strong>NGO:</strong> ${report.ngoName}</p>
                        <p><strong>Submitted:</strong> ${report.date}</p>
                        <p><strong>File:</strong> ${report.file.name} (${formatFileSize(report.file.size)})</p>
                        <p><strong>Plantation:</strong> ${report.reportData.plantationName}</p>
                        <p><strong>Area:</strong> ${report.reportData.areaCovered} hectares</p>
                    </div>
                    <div class="report-actions">
                        <button class="btn btn-approve" onclick="selectReport(${report.id})">Approve & Verify</button>
                        <button class="btn btn-reject" onclick="rejectReport(${report.id})">Reject</button>
                        <button class="btn btn-view" onclick="viewReport(${report.id})">View Report</button>
                    </div>
                `;
                reportsList.appendChild(reportCard);
            });
        }

        // Select a report for verification
        function selectReport(reportId) {
            selectedReport = pendingReports.find(r => r.id === reportId);
            
            if (selectedReport) {
                document.getElementById('selectedReportInfo').style.display = 'block';
                document.getElementById('noSelectionInfo').style.display = 'none';
                document.getElementById('verifyBtn').style.display = 'block';
                
                document.getElementById('reportName').textContent = selectedReport.file.name;
                document.getElementById('reportSize').textContent = formatFileSize(selectedReport.file.size);
                document.getElementById('reportNGO').textContent = selectedReport.ngoName;
                
                // Show preview of the report
                document.getElementById('reportPreview').textContent = selectedReport.content;
                
                document.getElementById('debugInfo').textContent = `Status: Report "${selectedReport.title}" selected for verification.`;
                
                updateStep(1);
            }
        }

        // Reject a report
        function rejectReport(reportId) {
            if (confirm('Are you sure you want to reject this report? This action cannot be undone.')) {
                // Remove from pending reports
                const index = pendingReports.findIndex(r => r.id === reportId);
                if (index !== -1) {
                    pendingReports.splice(index, 1);
                    
                    // Update localStorage
                    localStorage.setItem('pendingReports', JSON.stringify(pendingReports));
                    
                    renderPendingReports();
                    
                    if (selectedReport && selectedReport.id === reportId) {
                        resetVerificationUI();
                    }
                    
                    showNotification('Report rejected successfully.');
                }
            }
        }

        // View a report
        function viewReport(reportId) {
            const report = pendingReports.find(r => r.id === reportId);
            if (report) {
                // Create a blob and open in new tab
                const blob = new Blob([report.content], {type: 'text/plain'});
                const url = URL.createObjectURL(blob);
                window.open(url, '_blank');
            }
        }

        // Start the verification process (IPFS + Blockchain)
        async function startVerificationProcess() {
            if (!selectedReport) {
                alert('Please select a report first!');
                return;
            }

            try {
                updateStep(1);
                disableVerifyButton(true);
                showLoading(true);

                // Step 1: Auto-connect wallet
                updateStep(2);
                await connectWallet();
                
                // Step 2: Upload to IPFS
                updateStep(3);
                const ipfsResult = await uploadToIPFS(selectedReport);
                
                // Step 3: Store on blockchain
                updateStep(4);
                const blockchainResult = await storeOnBlockchain(ipfsResult);
                
                // Step 4: Show results
                updateStep(5);
                showFinalResults(ipfsResult, blockchainResult);
                
                // Remove the report from pending list
                const index = pendingReports.findIndex(r => r.id === selectedReport.id);
                if (index !== -1) {
                    pendingReports.splice(index, 1);
                    
                    // Update localStorage
                    localStorage.setItem('pendingReports', JSON.stringify(pendingReports));
                    
                    renderPendingReports();
                }
                
                showNotification('Report approved and stored on blockchain!');
                
            } catch (error) {
                console.error('Verification process failed:', error);
                alert('Error: ' + error.message);
                resetVerificationUI();
            }
        }

        // BigInt conversion functions
        function toBigInt(value) {
            return BigInt(value);
        }

        function toNumber(value) {
            return Number(value);
        }

        function toString(value) {
            return String(value);
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Connect to MetaMask wallet
        async function connectWallet() {
            if (typeof window.ethereum === 'undefined') {
                throw new Error('Please install MetaMask!');
            }

            // Request account access
            await window.ethereum.request({ method: 'eth_requestAccounts' });
            web3 = new Web3(window.ethereum);
            
            // Get accounts
            accounts = await web3.eth.getAccounts();
            if (accounts.length === 0) {
                throw new Error('No accounts found in MetaMask');
            }

            // Initialize contract
            contract = new web3.eth.Contract(CONTRACT_ABI, CONTRACT_ADDRESS);
            
            // Check if we're on Sepolia
            const chainId = await web3.eth.getChainId();
            const sepoliaChainId = toBigInt(11155111);
            
            if (chainId !== sepoliaChainId) {
                try {
                    await window.ethereum.request({
                        method: 'wallet_switchEthereumChain',
                        params: [{ chainId: '0xaa36a7' }],
                    });
                } catch (error) {
                    await window.ethereum.request({
                        method: 'wallet_addEthereumChain',
                        params: [{
                            chainId: '0xaa36a7',
                            chainName: 'Sepolia',
                            rpcUrls: ['https://sepolia.infura.io/v3/'],
                            nativeCurrency: { name: 'Sepolia ETH', symbol: 'ETH', decimals: 18 },
                            blockExplorerUrls: ['https://sepolia.etherscan.io']
                        }]
                    });
                }
            }
        }

        // Upload to IPFS using Pinata
        async function uploadToIPFS(report) {
            document.getElementById('debugInfo').textContent = 'Status: Uploading to IPFS...';
            
            // Create a blob from the report content
            const blob = new Blob([report.content], {type: 'text/plain'});
            const file = new File([blob], report.file.name, {type: 'text/plain'});
            
            const formData = new FormData();
            formData.append('file', file);

            const metadata = JSON.stringify({ name: file.name });
            formData.append('pinataMetadata', metadata);

            const options = JSON.stringify({ cidVersion: 0 });
            formData.append('pinataOptions', options);

            const response = await fetch('https://api.pinata.cloud/pinning/pinFileToIPFS', {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${PINATA_JWT}` },
                body: formData
            });

            if (!response.ok) {
                throw new Error('IPFS upload failed: ' + response.statusText);
            }

            const result = await response.json();
            return {
                hash: result.IpfsHash,
                fileName: report.file.name,
                fileSize: report.file.size
            };
        }

        // Store on blockchain
        async function storeOnBlockchain(ipfsData) {
            if (!contract || !accounts) {
                throw new Error('Wallet not connected');
            }

            try {
                document.getElementById('debugInfo').textContent = 'Status: Storing on blockchain...';
                
                // Estimate gas
                const gasEstimate = await contract.methods.storeHash(
                    ipfsData.hash,
                    ipfsData.fileName,
                    toBigInt(ipfsData.fileSize)
                ).estimateGas({ from: accounts[0] });

                // Convert gas estimate to number and add buffer
                const gasWithBuffer = toNumber(gasEstimate) * 1.2;

                // Send transaction
                const result = await contract.methods.storeHash(
                    ipfsData.hash,
                    ipfsData.fileName,
                    toBigInt(ipfsData.fileSize)
                ).send({
                    from: accounts[0],
                    gas: Math.round(gasWithBuffer)
                });

                return result;

            } catch (error) {
                if (error.message.includes('BigInt')) {
                    throw new Error('Blockchain error: Please try again with a smaller file');
                }
                throw error;
            }
        }

        // Show final results
        function showFinalResults(ipfsData, blockchainResult) {
            // Convert BigInt values to string for display
            const blockNumber = toString(blockchainResult.blockNumber);
            const gasUsed = toString(blockchainResult.gasUsed);

            document.getElementById('resultContent').innerHTML = `
                <div class="step">
                    <h4>üìÑ Report Information</h4>
                    <p><strong>Name:</strong> ${ipfsData.fileName}</p>
                    <p><strong>Size:</strong> ${formatFileSize(ipfsData.fileSize)}</p>
                    <p><strong>NGO:</strong> ${selectedReport.ngoName}</p>
                </div>
                
                <div class="step">
                    <h4>üåê IPFS Details</h4>
                    <p><strong>IPFS Hash (CID):</strong></p>
                    <div class="hash">${ipfsData.hash}</div>
                    <p><a href="https://gateway.pinata.cloud/ipfs/${ipfsData.hash}" target="_blank">üîó View on IPFS Gateway</a></p>
                </div>
                
                <div class="step">
                    <h4>‚õìÔ∏è Blockchain Details</h4>
                    <p><strong>Transaction Hash:</strong></p>
                    <div class="hash">${blockchainResult.transactionHash}</div>
                    <p><strong>Block Number:</strong> ${blockNumber}</p>
                    <p><strong>Gas Used:</strong> ${gasUsed}</p>
                    <p><a href="https://sepolia.etherscan.io/tx/${blockchainResult.transactionHash}" target="_blank">üîç View on Etherscan</a></p>
                </div>
            `;
            
            document.getElementById('results').style.display = 'block';
            showLoading(false);
            disableVerifyButton(false);
            
            document.getElementById('debugInfo').textContent = 'Status: Verification completed successfully!';
        }

        // UI Helper functions
        function updateStep(stepNumber) {
            for (let i = 1; i <= 5; i++) {
                const stepElement = document.getElementById('step' + i);
                stepElement.className = 'step';
            }
            
            const currentStep = document.getElementById('step' + stepNumber);
            if (currentStep) {
                currentStep.className = 'step active';
                
                // Mark previous steps as completed
                for (let i = 1; i < stepNumber; i++) {
                    document.getElementById('step' + i).className = 'step completed';
                }
            }
        }

        function disableVerifyButton(disabled) {
            const btn = document.getElementById('verifyBtn');
            btn.disabled = disabled;
            btn.textContent = disabled ? 
                '‚è≥ Processing...' : '‚úÖ Verify & Store on IPFS/Blockchain';
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        function resetVerificationUI() {
            selectedReport = null;
            document.getElementById('selectedReportInfo').style.display = 'none';
            document.getElementById('noSelectionInfo').style.display = 'block';
            document.getElementById('verifyBtn').style.display = 'none';
            document.getElementById('results').style.display = 'none';
            disableVerifyButton(false);
            showLoading(false);
            updateStep(1);
            document.getElementById('debugInfo').textContent = 'Status: Ready. No report selected.';
        }
        
        // Function to simulate receiving a report from ngo.html (for testing)
        function simulateNGOReport() {
            const testReport = {
                ngoName: "Green Earth NGO",
                registrationNo: "NGO-12345",
                contactPerson: "John Doe",
                contactEmail: "john@greenearth.org",
                plantationName: "Mangrove Restoration Project",
                reportDate: "2023-10-20",
                coastalRegion: "Sundarbans",
                areaCovered: "50",
                treeSpecies: "Mangrove",
                saplingsPlanted: "5000",
                survivalRate: "85",
                carbonAbsorbed: "250",
                biodiversityImpact: "Significant improvement in local biodiversity with return of fish and bird species.",
                additionalInfo: "Project is progressing well with community participation."
            };
            
            addReport(testReport);
        }
    </script>
</body>
</html>